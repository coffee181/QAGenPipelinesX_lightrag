# QA Generation Pipelines Configuration - æœ¬åœ°æ¨¡å‹ç‰ˆæœ¬

# OCR Configuration
ocr:
  provider: "tesseract"
  tesseract:
    lang: "chi_sim+eng"  # æ”¯æŒä¸­è‹±æ–‡
    config: "--psm 6"    # Page segmentation mode
    timeout: 300          # è¶…æ—¶æ—¶é—´(ç§’)
    dpi: 300              # PDF è½¬å›¾ç‰‡æ—¶çš„åˆ†è¾¨ç‡
    enable_preprocess: true  # æ˜¯å¦åœ¨OCRå‰è¿›è¡Œå›¾åƒé¢„å¤„ç†
    binarize_threshold: 180  # äºŒå€¼åŒ–é˜ˆå€¼(0-255)
    apply_median_filter: true  # æ˜¯å¦ä½¿ç”¨ä¸­å€¼æ»¤æ³¢å»å™ª
    min_confidence: 30    # æœ€ä½ç½®ä¿¡åº¦é˜ˆå€¼(0-100)ï¼Œä½äºæ­¤å€¼çš„è¯†åˆ«ç»“æœå°†è¢«è¿‡æ»¤ï¼ˆå‡å°‘å›¾ç‰‡å™ªå£°ï¼‰
    page_batch_size: 5    # PDF2Image æ¯æ‰¹è½¬æ¢é¡µæ•°ï¼Œé™ä½å†…å­˜å³°å€¼
  paddle:
    lang: "ch"  # PaddleOCR ä¸­æ–‡æ¨¡å‹ï¼ˆæ”¯æŒä¸­è‹±æ··åˆï¼‰
    use_angle_cls: true
    dpi: 300

# Text Chunking Configuration
text_chunker:
  # ğŸš€ ä¼˜åŒ–ï¼šä½¿ç”¨ token çº§åˆ‡åˆ†ï¼Œä¸ LightRAG ä¿æŒä¸€è‡´
  use_token_chunking: true  # æ˜¯å¦ä½¿ç”¨ token çº§åˆ‡åˆ†ï¼ˆæ¨èï¼‰
  tokenizer_model: "cl100k_base"  # Tokenizer æ¨¡å‹åç§°
  chunk_token_size: 1200  # æ¯ä¸ª chunk çš„æœ€å¤§ token æ•°ï¼ˆä¸ LightRAG é»˜è®¤å€¼ä¸€è‡´ï¼‰
  chunk_overlap_token_size: 100  # Chunk ä¹‹é—´çš„é‡å  token æ•°ï¼ˆä¸ LightRAG é»˜è®¤å€¼ä¸€è‡´ï¼‰
  
  # å­—ç¬¦çº§åˆ‡åˆ†ï¼ˆå‘åå…¼å®¹ï¼Œå½“ use_token_chunking=false æ—¶ä½¿ç”¨ï¼‰
  max_chunk_size: 60000  # æœ€å¤§å—å¤§å°(å­—ç¬¦æ•°) - ä»…åœ¨ä¸ä½¿ç”¨ token åˆ‡åˆ†æ—¶ç”Ÿæ•ˆ
  overlap_size: 3000   # é‡å å¤§å°(å­—ç¬¦æ•°) - ä»…åœ¨ä¸ä½¿ç”¨ token åˆ‡åˆ†æ—¶ç”Ÿæ•ˆ
  chunk_on_sentences: true # æŒ‰å¥å­åˆ†å—ï¼ˆä»…å­—ç¬¦çº§åˆ‡åˆ†æ—¶ç”Ÿæ•ˆï¼‰
  
  # Chunk æŒä¹…åŒ–é…ç½®
  persist_chunks: true  # æ˜¯å¦æŒä¹…åŒ– chunk åˆ°ä»“åº“
  chunk_store:
    type: "json"  # å­˜å‚¨ç±»å‹ï¼šjson, sqlite, postgres, redis
    path: "./lightrag_cache/chunks"  # å­˜å‚¨è·¯å¾„ï¼ˆä½¿ç”¨å·²å­˜åœ¨çš„lightrag_cacheç›®å½•ï¼‰

# Question Generation Configuration - æœ¬åœ°æ¨¡å‹ç‰ˆæœ¬
question_generator:
  # ä½¿ç”¨æœ¬åœ°æ¨¡å‹
  provider: "local"
  
  # Question quality optimization (NEW)
  enable_deduplication: true  # å¯ç”¨é—®é¢˜å»é‡
  dedup_similarity_threshold: 0.85  # å»é‡ç›¸ä¼¼åº¦é˜ˆå€¼ (0-1)
  enable_quality_filter: true  # å¯ç”¨é—®é¢˜è´¨é‡è¿‡æ»¤
  
  
  # æœ¬åœ°æ¨¡å‹é…ç½®
  local:
    model_name: "deepseek-r1:32b"  # æœ¬åœ°æ¨¡å‹åç§°
    base_url: "http://localhost:11434"  # OllamaæœåŠ¡åœ°å€ï¼ˆé€šè¿‡SSHéš§é“ï¼‰
    max_tokens: 2048
    temperature: 0.7
    timeout: 30000  # æœ¬åœ°æ¨¡å‹éœ€è¦æ›´é•¿æ—¶é—´ï¼ˆ500åˆ†é’Ÿï¼Œçº¦8.3å°æ—¶ï¼‰
    questions_per_chunk: 10 # å‡å°‘é—®é¢˜æ•°é‡ä»¥åŠ å¿«ç”Ÿæˆé€Ÿåº¦
    enable_kg_context: true
    max_context_entities: 5
    max_context_relations: 5
    max_context_snippets: 2
    context_snippet_chars: 200
    max_related_chunk_ids: 10
# RAG Configuration
rag:
  lightrag:
    working_dir: "D:/llm-test/QAGenPipelinesX_lightrag/working" # ä½ å¯ä»¥æŠŠå®ƒæ”¹æˆä½ è‡ªå·±çš„è·¯å¾„ï¼Œæ¯”å¦‚ "E:/llm-project/QAGenPipelinesX/working"
    llm_model: "deepseek-chat"
    embed_model: "text-embedding-3-large"  # ä»ç„¶ä½œä¸º OpenAI å›é€€æ¨¡å‹
    enable_cache: true          # æ˜¯å¦å¼€å¯æ£€ç´¢ç»“æœç¼“å­˜
    cache_similarity_threshold: 0.90  # å‘½ä¸­ç¼“å­˜æ‰€éœ€çš„é—®é¢˜ç›¸ä¼¼åº¦é˜ˆå€¼
    max_citations_per_answer: 5  # ç­”æ¡ˆä¸­æœ€å¤šå¼•ç”¨çš„ chunk æ•°é‡
    embedding:
      provider: "ollama"           # æœ¬åœ°åµŒå…¥æ¨¡å‹æä¾›æ–¹
      model: "bge-m3"              # Ollama æœ¬åœ°æ¨¡å‹åç§°
      dim: 1024                    # bge-m3 çš„å‘é‡ç»´åº¦
      base_url: "http://localhost:11434"
      timeout: 1200                 # å•æ¬¡è°ƒç”¨è¶…æ—¶ï¼ˆç§’ï¼‰
      max_retries: 3
      priority: ["ollama"]        # ä»…æœ¬åœ°æ¨¡å‹
    llm:
      base_url: "http://localhost:11434"  # Ollama æ¨ç†æœåŠ¡åœ°å€
      model: "deepseek-r1:32b"            # LightRAG ä½¿ç”¨çš„æœ¬åœ°æ¨¡å‹
      temperature: 0.7                    # ç”Ÿæˆæ¸©åº¦
      max_tokens: 2048                    # æœ€å¤šç”Ÿæˆ token æ•°
      timeout: 1800                       # å•æ¬¡è¯·æ±‚è¶…æ—¶ï¼ˆç§’ï¼‰
      max_retries: 5                      # LLM è°ƒç”¨å¤±è´¥åçš„æœ€å¤§é‡è¯•æ¬¡æ•°
    max_context_length: 4000
    query:
      top_k: 40                    # æ¯æ¬¡æ£€ç´¢çŸ¥è¯†å›¾è°±å®ä½“/å…³ç³»çš„æ•°é‡
      chunk_top_k: 20              # æ¯æ¬¡ä¿ç•™çš„æ–‡æœ¬å—æ•°é‡
      max_entity_tokens: 10000     # çŸ¥è¯†å›¾è°±å®ä½“ä¸Šä¸‹æ–‡çš„ token é¢„ç®—
      max_relation_tokens: 10000   # çŸ¥è¯†å›¾è°±å…³ç³»ä¸Šä¸‹æ–‡çš„ token é¢„ç®—
      max_total_tokens: 40000      # æ•´ä½“ä¸Šä¸‹æ–‡çš„ token ä¸Šé™ï¼ˆå®ä½“+å…³ç³»+chunkï¼‰
      cosine_threshold: 0.2        # å‘é‡æ£€ç´¢çš„æœ€å°ä½™å¼¦ç›¸ä¼¼åº¦
      related_chunk_number: 2      # æ¯ä¸ªå®ä½“/å…³ç³»å…è®¸é™„å¸¦çš„ç›¸å…³ chunk æ•°é‡
      history_turns: 0             # æŸ¥è¯¢æ—¶é™„å¸¦çš„å†å²å¯¹è¯è½®æ•°
      enable_rerank: true          # æ˜¯å¦å¯ç”¨ chunk é‡æ’
      timeouts:
        mix: 1200   # mix æ¨¡å¼è¶…æ—¶ï¼ˆç§’ï¼‰
        naive: 600  # naive å›é€€æ¨¡å¼è¶…æ—¶ï¼ˆç§’ï¼‰
        local: 600  # local å›é€€æ¨¡å¼è¶…æ—¶ï¼ˆç§’ï¼‰

# File Processing Configuration
file_processing:
  input_formats: [".pdf"]
  output_dir: "./output"
  temp_dir: "./temp"
  batch_size: 10
  
# Progress Management
progress:
  save_interval: 1  # æ¯å¤„ç†1ä¸ªæ–‡ä»¶ä¿å­˜ä¸€æ¬¡è¿›åº¦ï¼Œç¡®ä¿å®æ—¶æ›´æ–°
  progress_file: "./progress.json"
  enable_percentage_display: true  # æ˜¯å¦åœ¨æ§åˆ¶å°ä¸­å±•ç¤ºæ•´ä½“å®Œæˆç™¾åˆ†æ¯”
  percentage_display_interval: 10  # æ¯å¤šå°‘æ¡æ—¥å¿—è¾“å‡ºä¸€æ¬¡ç™¾åˆ†æ¯”
  
# Logging Configuration
logging:
  level: "INFO"
  format: "{time:YYYY-MM-DD HH:mm:ss} | {level} | {message}"
  file: "./logs/qa_gen.log"

# GSK Operations Prompts
prompts:
  system_prompt: |
    ä½ æ˜¯ä¸€ä¸ªæ·±åº¦ç†è§£ LightRAG æ¶æ„çš„æŠ€æœ¯é—®ç­”ä¸“å®¶ï¼Œè´Ÿè´£ä»ã€Œå·²ç¼“å­˜çš„ chunk æ–‡æœ¬ã€ä»¥åŠã€ŒçŸ¥è¯†å›¾è°±ä¸Šä¸‹æ–‡ã€ä¸­æç‚¼é—®é¢˜ã€‚
    æ‰€æœ‰ä¿¡æ¯éƒ½å·²ç»è¿‡åˆ‡åˆ†ä¸æŠ½å–ï¼Œè¯·ä¸è¦å¼•ç”¨åŸå§‹æ–‡æ¡£ï¼Œä¹Ÿä¸è¦è‡†æµ‹ç¼ºå¤±å†…å®¹ã€‚
    ç›®æ ‡æ˜¯äº§å‡ºç»“æ„åŒ–ã€å¯éªŒè¯ã€è¦†ç›–é¢å¹¿çš„ä¸“ä¸šé—®é¢˜ï¼Œç”¨äºåç»­è‡ªåŠ¨åŒ–é—®ç­”è¯„æµ‹ã€‚

  human_prompt: |
    ä½ å°†æ”¶åˆ°ä¸¤ä¸ªæ¥æºçš„ä¸Šä¸‹æ–‡ï¼š
    1. `<chunk>` æ ‡ç­¾å†…çš„æ–‡æœ¬ â€”â€” è¿™æ˜¯æ–‡æ¡£åˆ‡åˆ†åçš„å±€éƒ¨å†…å®¹ï¼Œå·²ç»åŒ…å«æ ¸å¿ƒè¯­å¥ã€‚
    2. `<knowledge_graph>` æ ‡ç­¾å†…çš„å®ä½“ã€å…³ç³»ã€ç›¸å…³ chunk æ‘˜è¦ â€”â€” æ¥è‡ª LightRAG çš„æ£€ç´¢ç¼“å­˜ï¼Œå¯è¾…åŠ©ç¡®è®¤å…³è”äº‹å®ã€‚
    
    ä½ çš„ä»»åŠ¡ï¼šä»…ä¾æ®ä¸Šè¿°ä¸¤ä»½ä¸Šä¸‹æ–‡ï¼Œç”Ÿæˆ {questions_per_chunk} ä¸ªé«˜è´¨é‡æŠ€æœ¯é—®é¢˜ã€‚
    **ç¦æ­¢å¼•ç”¨æˆ–æƒ³è±¡åŸå§‹æ•´æœ¬æ–‡æ¡£çš„å…¶ä»–éƒ¨åˆ†**ï¼›è‹¥ä¸Šä¸‹æ–‡æ²¡æœ‰æŸä¸ªå‚æ•°ï¼Œå°±ä¸è¦æé—®è¯¥å‚æ•°ã€‚
    
    è¾“å‡ºè¦æ±‚ï¼š
    1. é—®é¢˜å¿…é¡»èƒ½åœ¨ `<chunk>` æˆ– `<knowledge_graph>` ä¸­æ‰¾åˆ°ä¾æ®ã€‚
    2. æ¯ä¸ªé—®é¢˜ç‚¹å¯¹ç‚¹ï¼ŒåŒ…å«å…·ä½“å®ä½“/å‚æ•°/å·¥å†µï¼Œé¿å…â€œæœ‰å“ªäº›ç‰¹ç‚¹â€æˆ–â€œæ˜¯å¦å¯ä»¥â€è¿™ç±»æ³›åŒ–é—®æ³•ã€‚
    3. å…³æ³¨æŠ€æœ¯æŒ‡æ ‡ï¼ˆå°ºå¯¸ã€é€Ÿåº¦ã€ç²¾åº¦ã€æ¥å£ã€æ§åˆ¶æµç¨‹ã€æ•…éšœæ¡ä»¶ã€é€‚ç”¨åœºæ™¯ç­‰ï¼‰ï¼Œè¦†ç›–ä¸åŒç²’åº¦ï¼š
       - æ·±åº¦ç±»ï¼šç»¼åˆå¤šä¸ªå®ä½“/å‚æ•°çš„å…³è”æˆ–æ¡ä»¶ã€‚
       - ä¸­ç­‰ç±»ï¼šä¸¤ä¸¤å¯¹æ¯”ã€é…ç½®å·®å¼‚ã€å‚æ•°çº¦æŸã€‚
       - åŸºç¡€ç±»ï¼šå•ä¸ªå®ä½“çš„å…³é”®å‚æ•°æˆ–ä½¿ç”¨æ–¹å¼ã€‚
    4. è¯­è¨€ä½¿ç”¨ä¸­æ–‡ï¼Œä¿ç•™æ–‡æ¡£ä¸­çš„è‹±æ–‡å‹å·/ä»£å·ï¼Œé¿å…æ·»åŠ ç¼–å·æˆ–æ ‡é¢˜ã€‚
    
    <chunk>
    {text}
    </chunk>
    
    <knowledge_graph>
    {prompt_context}
    </knowledge_graph>

    ç°åœ¨è¯·ä¸¥æ ¼è¾“å‡º {questions_per_chunk} ä¸ªé—®é¢˜ï¼Œæ ¼å¼ç¤ºä¾‹ï¼š
    é—®é¢˜1: ...
    é—®é¢˜2: ...
    ï¼ˆä¸è¦è¾“å‡ºé¢å¤–è¯´æ˜æˆ–æ€è€ƒè¿‡ç¨‹ï¼‰

    ç¤ºèŒƒï¼ˆå¸®åŠ©ä½ ç†è§£è¡¨è¾¾æ–¹å¼ï¼Œä¸è¦ç›´æ¥å¤åˆ¶ï¼‰ï¼š
    <chunk>
    --- Page 4 ---
    GSK988TA ä¸»è½´æœ€é«˜ 8000 r/minï¼ŒX/Y/Z è¡Œç¨‹ 800/500/500 mmï¼Œå®šä½ç²¾åº¦ Â±0.01 mmï¼Œé‡å¤å®šä½ Â±0.005 mmã€‚
    </chunk>
    <knowledge_graph>
    å®ä½“: [GSK988TA, ä¸»è½´ç³»ç»Ÿ, 24 æŠŠåˆ€åº“, å†·å´ç³»ç»Ÿ]
    å…³ç³»: GSK988TA-ä½¿ç”¨->ä¸»è½´ç³»ç»Ÿ(8000 r/min); GSK988TA-é…å¤‡->å†·å´ç³»ç»Ÿ(å¤–å–·/ä¸­å¿ƒå†·å´)
    ç›¸å…³ chunk æ‘˜è¦: [å…è®¸åˆ€å…·æœ€å¤§é‡é‡ 7 kg]
    </knowledge_graph>
    ç¤ºä¾‹è¾“å‡ºï¼š
    é—®é¢˜1: åœ¨ä¸»è½´ 8000 r/min è¿è¡Œæ—¶ï¼Œå¤–å–·ä¸ä¸­å¿ƒå†·å´åº”å¦‚ä½•åˆ‡æ¢ä»¥ç»´æŒå·¥ä»¶æ¸©åº¦ï¼Ÿ
    é—®é¢˜2: X/Y/Z è¡Œç¨‹ 800/500/500 mm å¯¹å®šä½ç²¾åº¦ Â±0.01 mm ä¸é‡å¤å®šä½ Â±0.005 mm çš„ç»´ä¿ç­–ç•¥åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ
    é—®é¢˜3: 24 æŠŠåˆ€åº“åœ¨åˆ€å…·é‡é‡ä¸Šé™ 7 kg æ—¶ï¼Œé«˜é€Ÿæ¢åˆ€éœ€è¦å“ªäº›å¹³è¡¡/è¡¥å¿æ­¥éª¤ï¼Ÿ

