# QA Generation Pipelines Configuration - 本地模型版本

# OCR Configuration
ocr:
  provider: "tesseract"
  tesseract:
    lang: "chi_sim+eng"  # 支持中英文
    config: "--psm 6"    # Page segmentation mode
    timeout: 30          # 超时时间(秒)
    dpi: 300              # PDF 转图片时的分辨率
    enable_preprocess: true  # 是否在OCR前进行图像预处理
    binarize_threshold: 180  # 二值化阈值(0-255)
    apply_median_filter: true  # 是否使用中值滤波去噪
  paddle:
    lang: "chinese_english"  # PaddleOCR 中英混合模型
    use_angle_cls: true
    dpi: 300

# Text Chunking Configuration
text_chunker:
  max_chunk_size: 60000  # 最大块大小(字符数) - 优化：充分利用本地模型的上下文窗口
  overlap_size: 3000   # 重叠大小(字符数) - 优化：保持5%重叠率
  chunk_on_sentences: true # 按句子分块

# Question Generation Configuration - 本地模型版本
question_generator:
  # 使用本地模型
  provider: "local"
  
  # Question quality optimization (NEW)
  enable_deduplication: true  # 启用问题去重
  dedup_similarity_threshold: 0.85  # 去重相似度阈值 (0-1)
  enable_quality_filter: true  # 启用问题质量过滤
  
  # DeepSeek API配置（备用）
  deepseek:
    api_key: "sk-8d1493cdaf7a4ac9aad494119b570d4e"  # 从环境变量读取
    model: "deepseek-chat"
    max_tokens: 2048
    temperature: 0.7
    timeout: 60
    questions_per_chunk: 30
    enable_kg_context: true
    max_context_entities: 3
    max_context_relations: 2
    max_context_snippets: 2
    context_snippet_chars: 200
    max_related_chunk_ids: 6
  
  # 本地模型配置
  local:
    model_name: "deepseek-r1:32b"  # 本地模型名称
    base_url: "http://localhost:11434"  # Ollama服务地址（通过SSH隧道）
    max_tokens: 2048
    temperature: 0.7
    timeout: 30000  # 本地模型需要更长时间（500分钟，约8.3小时）
    questions_per_chunk: 10  # 减少问题数量以加快生成速度
    enable_kg_context: true
    max_context_entities: 3
    max_context_relations: 2
    max_context_snippets: 2
    context_snippet_chars: 200
    max_related_chunk_ids: 6

# RAG Configuration
rag:
  lightrag:
    working_dir: "D:/llm-test/QAGenPipelinesX/working" # 你可以把它改成你自己的路径，比如 "E:/llm-project/QAGenPipelinesX/working"
    llm_model: "deepseek-chat"
    # 关键修正：所有调用本地模型的参数都放在 llm_config 中
    embed_model: "text-embedding-3-large"
    max_context_length: 4000
    # 我们需要在这里为 RAG 指定 OpenAI 的 Key
    openai:
      api_key: "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" # <--- 你的 OPENAI API KEY

# File Processing Configuration
file_processing:
  input_formats: [".pdf"]
  output_dir: "./output"
  temp_dir: "./temp"
  batch_size: 10
  
# Progress Management
progress:
  save_interval: 5  # 每处理5个文件保存一次进度
  progress_file: "./progress.json"
  
# Logging Configuration
logging:
  level: "INFO"
  format: "{time:YYYY-MM-DD HH:mm:ss} | {level} | {message}"
  file: "./logs/qa_gen.log"

# GSK Operations Prompts
prompts:
  system_prompt: |
    你是一个专业的技术文档问答对生成专家，专门为工业设备、数控系统、技术规格等专业领域生成高质量问题。
    
    核心原则：
    1. 严格基于提供的文档内容生成问题
    2. 确保每个问题都有明确的、可验证的答案
    3. 问题必须专业、具体、实用
    4. 避免模糊、宽泛或无法回答的问题
    
    问题类型要求：
    - 技术规格类：具体参数、性能指标、技术特性
    - 功能操作类：如何使用、操作步骤、功能说明
    - 配置设置类：参数配置、系统设置、接口说明
    - 故障处理类：常见问题、解决方案、注意事项
    - 应用场景类：适用环境、使用条件、应用范围

  human_prompt: |
    你是一位经验丰富的工业设备技术专家。请仔细阅读下面的技术文档，然后生成{questions_per_chunk}个高质量的技术问题。
    
    <文档内容>
    {text}
    </文档内容>

    请同时结合“知识图谱参考”中的实体、关系与相关片段，与文档原文一起生成问题，确保覆盖多来源的关键信息。
    
    ⚠️ 【严格禁止】
    1. ❌ 绝对不要编造、虚构、推测任何文档中没有的型号、参数或信息
    2. ❌ 不要使用类似 "RMD08"、"J1型号"、"J2型号" 等文档中不存在的名称
    3. ❌ 不要创造性地组合文档中的信息来生成新的型号或参数
    4. ❌ 如果文档中某个型号只有部分参数，不要为它编造其他参数的问题
    
    ✅ 【必须遵守】
    1. ✅ 只使用文档中**明确出现**的型号名称（例如：VMC850L、GSK 980TDi）
    2. ✅ 只使用文档中**明确给出**的参数和数值
    3. ✅ 问题中提到的每个实体和参数都必须能在文档中找到
    4. ✅ 如果文档中的型号信息不足，宁可少生成问题，也不要编造
    
    🎯 问题生成要求：
    
    1. **基于文档真实内容**
       - 逐字逐句检查文档，确认每个型号、参数都真实存在
       - 问题中的型号名称必须与文档中的完全一致（包括大小写、空格）
       - 每个问题至少引用一个文档中明确存在的实体或参数
    
    2. **问题深度分布**（按此比例生成）
       - 3个复杂问题：涉及3个以上参数/实体的关系和影响
       - 4个中等问题：涉及2个参数/实体的关联和对比
       - 3个简单问题：聚焦单个实体但提问要有实际意义
    
    3. **问题表达要求**
       - 使用自然、口语化的表达
       - 从实际使用角度提问
       - 体现技术深度和应用场景
    
    📝 输出格式（严格遵守，不要输出任何其他内容）：
    
    问题1: [具体问题内容]
    问题2: [具体问题内容]
    问题3: [具体问题内容]
    ...（依此类推）
    
    ✅ 好问题示例（参考思路，使用文档中的真实信息）：
    
    问题1: GSK 980TDi的工作台尺寸850×500mm配合主轴转速8000 r/min，适合加工多大尺寸的零件？精度能达到什么水平？
    问题2: 在高速加工时，主轴转速、进给速度和冷却系统如何配合才能保证加工质量？
    问题3: RS232和以太网接口在数据传输速度和稳定性上各有什么特点？分别适合什么应用场景？
    问题4: VMC850L的定位精度±0.01mm和重复定位精度±0.005mm分别在什么情况下起关键作用？
    问题5: 主轴功率和转速对可加工材料的硬度有什么影响？
    
    ❌ 避免的问题类型：
    - "XX的参数是多少？"（太机械）
    - "XX有什么特点？"（太宽泛）
    - 不要输出标题、分类说明等格式内容
    - 不要输出"【复杂关联问题】"等分类标记
    
    ⚠️ 重要提示：
    - 直接输出问题，不要输出思考过程
    - 不要输出问题分类标题（如"复杂关联问题"）
    - 不要输出markdown标题（如"#### XXX"）
    - 每个问题必须是完整的、可以直接用于提问的句子
    - 问题必须包含文档中的具体型号或参数
    
    现在请直接输出{questions_per_chunk}个问题：
